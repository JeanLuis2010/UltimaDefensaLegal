<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gracias — Ultima Defensa Legal</title>
  <meta name="description" content="Confirmación de membresía — Ultima Defensa Legal">
  <link rel="stylesheet" href="css/style.css" />
  <style>
    :root { --max: 900px; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#111; line-height:1.5; }
    .container { max-width: var(--max); margin: 0 auto; padding: 1rem; }
    header, main, footer { width:100%; }
    header { border-bottom:1px solid #eee; background:#fafafa; }
    .row { display:flex; align-items:center; justify-content:space-between; gap:.75rem; }
    .h1 { font-size: clamp(1.6rem, 2.4vw, 2.2rem); margin: .5rem 0; font-weight:800; }
    .muted { color:#555; }
    .card { border:1px solid #e5e7eb; border-radius:16px; padding:1rem; background:#fff; }
    .grid { display:grid; grid-template-columns: 1fr; gap:1rem; }
    @media (min-width: 720px){ .grid { grid-template-columns: 1.2fr .8fr; } }
    .btn { display:inline-block; padding:.7rem 1rem; border-radius:12px; text-decoration:none; cursor:pointer; }
    .btn-primary { background:#111; color:#fff; border:1px solid #111; }
    .btn-secondary { background:#fff; color:#111; border:1px solid #111; }
    .btn-link { background:none; border:none; text-decoration:underline; cursor:pointer; padding:0; }
    .stack { display:flex; flex-wrap:wrap; gap:.5rem; }
    dl { display:grid; grid-template-columns: max-content 1fr; gap:.4rem .8rem; margin:0; }
    dt { color:#666; }
    dd { margin:0; }
    footer { border-top:1px solid #eee; background:#fafafa; margin-top:2rem; }
    .center { text-align:center; }
  </style>
</head>
<body>
  <header>
    <div class="container row">
      <div class="row" style="gap:.5rem">
        <a href="index.html" style="text-decoration:none; color:#111; font-weight:800;">Ultima Defensa Legal</a>
      </div>
      <div class="stack">
        <button class="btn-secondary" onclick="UDL_UI?.setLang('en')">EN</button>
        <button class="btn-secondary" onclick="UDL_UI?.setLang('es')">ES</button>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="h1" id="t-title">¡Gracias! Tu membresía está activa.</h1>
    <p class="muted" id="t-sub">
      Revisa tu correo con tu ID de miembro y detalles de acceso. Guarda esta página o imprime el recibo.
    </p>

    <div class="grid" style="margin-top:1rem">
      <!-- Left: Confirmation details -->
      <section class="card">
        <h2 style="margin:.2rem 0 1rem" id="t-summary">Resumen</h2>
        <dl>
          <dt id="t-memberid-label">ID de Miembro</dt>
          <dd id="member-id">–</dd>

          <dt id="t-plan-label">Plan</dt>
          <dd id="plan-name">–</dd>

          <dt id="t-term-label">Plazo</dt>
          <dd id="plan-term">/3 meses</dd>

          <dt id="t-order-label">N.º de pedido</dt>
          <dd id="order-id">–</dd>

          <dt id="t-email-label">Correo</dt>
          <dd id="email">–</dd>
        </dl>

        <div class="stack" style="margin-top:1rem">
          <a id="btn-extend" href="#" class="btn btn-primary">Extender 3 meses</a>
          <a id="btn-home" href="index.html" class="btn btn-secondary">Inicio</a>
          <button id="btn-print" class="btn btn-link">Imprimir recibo</button>
        </div>
      </section>

      <!-- Right: Next steps -->
      <aside class="card">
        <h3 style="margin:.2rem 0 1rem" id="t-next">Próximos pasos</h3>
        <ol class="muted" id="next-steps">
          <li>Guarda tu ID de miembro. Lo necesitarás cuando llames.</li>
          <li>Llámanos y elige el área legal; te conectamos con un abogado.</li>
          <li>Los abogados participantes ofrecen al menos una consulta gratuita o con descuento para miembros activos.</li>
        </ol>
        <p class="muted" id="t-note" style="margin-top:1rem">
          Si algo no coincide con tu compra, contáctanos y lo corregimos.
        </p>
      </aside>
    </div>

    <p class="center muted" style="margin-top:1.5rem" id="t-help">
      ¿Necesitas ayuda? Escríbenos desde la página de <a href="contact.html">Contacto</a>.
    </p>
  </main>

  <footer>
    <div class="container center">
      <p class="muted">© <span id="year"></span> Ultima Defensa Legal</p>
    </div>
  </footer>

  <!-- Load site config then page logic -->
  <script src="pricing-config.js"></script>
  <script>
    (function(){
      const CFG = window.UDL_CONFIG || {};
      const storage = window.localStorage;

      // --- Language handling (default Spanish) ---
      function getLang(){ return storage.getItem("udl_lang") || "es"; }
      function setLang(lang){ storage.setItem("udl_lang", lang); document.documentElement.setAttribute("lang", lang); render(); }
      window.UDL_UI = window.UDL_UI || {}; window.UDL_UI.setLang = setLang;

      // --- Text helpers ---
      const $ = (s)=>document.querySelector(s);
      function setText(sel, dict){ if(!dict) return; const el=$(sel); if(el) el.textContent = dict[lang] || dict.en || el.textContent; }
      function getDeep(dict, path){
        const parts = (path||"").split(".");
        let ref = dict;
        for(const p of parts){ if(!ref) return null; ref = ref[p]; }
        return ref || null;
      }

      // --- URL params (optional) ---
      const params = new URLSearchParams(location.search);
      const provided = {
        memberId: params.get("memberId"),
        order:    params.get("order"),
        plan:     params.get("plan"),     // e.g., INDIVIDUAL_3MO
        email:    params.get("email")
      };

      // --- Find active population (first one with active:true) ---
      function getActivePopulation(){
        const pops = CFG.populations || {};
        const key = Object.keys(pops).find(k => pops[k]?.active);
        return key ? pops[key] : null;
      }

      // --- Map plan code to display fields from active population ---
      function getPlanInfo(planCode){
        const pop = getActivePopulation();
        if(!pop) return null;
        const plan = pop.plans?.[planCode];
        if(!plan) return null;
        return plan;
      }

      // --- Build Extend link from active population (EXTEND_3MO) ---
      function getExtendLink(){
        const pop = getActivePopulation();
        const plan = pop?.plans?.EXTEND_3MO;
        return plan?.checkoutLinks?.US || "#";
      }

      // --- i18n dictionaries for this page ---
      const dict = {
        title:        { en: "Thank you! Your membership is active.", es: "¡Gracias! Tu membresía está activa." },
        sub:          { en: "Check your email for your Member ID and access details. Save this page or print your receipt.", es: "Revisa tu correo con tu ID de miembro y detalles de acceso. Guarda esta página o imprime el recibo." },
        summary:      { en: "Summary", es: "Resumen" },
        memberId:     { en: "Member ID", es: "ID de Miembro" },
        plan:         { en: "Plan", es: "Plan" },
        term:         { en: "Term", es: "Plazo" },
        order:        { en: "Order #", es: "N.º de pedido" },
        email:        { en: "Email", es: "Correo" },
        extend:       { en: "Extend 3 months", es: "Extender 3 meses" },
        home:         { en: "Home", es: "Inicio" },
        print:        { en: "Print receipt", es: "Imprimir recibo" },
        next:         { en: "Next steps", es: "Próximos pasos" },
        steps: {
          en: [
            "Save your Member ID. You'll need it when you call.",
            "Call us, choose your practice area, and we connect you to an attorney.",
            "Participating attorneys offer at least one free or reduced consultation to active members."
          ],
          es: [
            "Guarda tu ID de miembro. Lo necesitarás cuando llames.",
            "Llámanos, selecciona la especialidad legal, y te conectamos con un abogado.",
            "Los abogados participantes ofrecen al menos una consulta gratuita o con descuento a miembros activos."
          ]
        },
        note: { en: "If anything doesn't match your purchase, contact us and we'll fix it.", es: "Si algo no coincide con tu compra, contáctanos y lo corregimos." }
      };

      let lang = getLang();

      function render(){
        lang = getLang();
        document.documentElement.setAttribute("lang", lang);

        // Header texts
        $("#t-title").textContent = dict.title[lang];
        $("#t-sub").textContent   = dict.sub[lang];

        // Summary labels
        $("#t-summary").textContent       = dict.summary[lang];
        $("#t-memberid-label").textContent= dict.memberId[lang];
        $("#t-plan-label").textContent    = dict.plan[lang];
        $("#t-term-label").textContent    = dict.term[lang];
        $("#t-order-label").textContent   = dict.order[lang];
        $("#t-email-label").textContent   = dict.email[lang];

        // Details from URL / config
        $("#member-id").textContent = provided.memberId || "—";
        $("#order-id").textContent  = provided.order    || "—";
        $("#email").textContent     = provided.email    || "—";

        // Plan fields
        const planInfo = getPlanInfo(provided.plan) || getPlanInfo("INDIVIDUAL_3MO");
        $("#plan-name").textContent = (planInfo?.name?.[lang] || planInfo?.name?.en || provided.plan || "—");
        $("#plan-term").textContent = (planInfo?.term?.[lang] || planInfo?.term?.en || "/3 meses");

        // Buttons
        const extLink = getExtendLink();
        const btnExt  = $("#btn-extend");
        const btnHome = $("#btn-home");
        if (btnExt)  btnExt.textContent = dict.extend[lang], btnExt.href = extLink || "#";
        if (btnHome) btnHome.textContent = dict.home[lang];

        // Next steps
        $("#t-next").textContent = dict.next[lang];
        const stepsList = $("#next-steps");
        if (stepsList) {
          const items = dict.steps[lang] || dict.steps.en;
          stepsList.innerHTML = "";
          items.forEach(s => { const li = document.createElement("li"); li.textContent = s; stepsList.appendChild(li); });
        }
        $("#t-note").textContent = dict.note[lang];

        // Footer year
        const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
      }

      // Print
      $("#btn-print").addEventListener("click", () => window.print());

      // Initial render
      render();
    })();
  </script>
</body>
</html>
